(window.__wcAdmin_webpackJsonp=window.__wcAdmin_webpackJsonp||[]).push([[16],{518:function(e,t,r){"use strict";r.r(t);var a=r(0),o=r(1),n=r.n(o),s=r(2),i=r(567),c=r(542),l=r(540),d=r(543),m=r(5),u=r(22),p=r(13),b=r(136),y=r(539),g=r(545),h=r(536);class _ extends a.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:Object(s.__)("Tax code","woocommerce-admin"),key:"tax_code",required:!0,isLeftAligned:!0,isSortable:!0},{label:Object(s.__)("Rate","woocommerce-admin"),key:"rate",isSortable:!0,isNumeric:!0},{label:Object(s.__)("Total tax","woocommerce-admin"),key:"total_tax",isSortable:!0},{label:Object(s.__)("Order tax","woocommerce-admin"),key:"order_tax",isSortable:!0},{label:Object(s.__)("Shipping tax","woocommerce-admin"),key:"shipping_tax",isSortable:!0},{label:Object(s.__)("Orders","woocommerce-admin"),key:"orders_count",required:!0,defaultSort:!0,isSortable:!0,isNumeric:!0}]}getRowsContent(e){const{render:t,formatDecimal:r,getCurrencyConfig:o}=this.context;return Object(m.map)(e,e=>{const{query:n}=this.props,{order_tax:s,orders_count:i,tax_rate:c,tax_rate_id:l,total_tax:d,shipping_tax:m}=e,g=Object(y.a)(e),h=Object(p.getPersistedQuery)(n),_=Object(p.getNewPath)(h,"/analytics/orders",{filter:"advanced",tax_rate_includes:l});return[{display:Object(a.createElement)(u.Link,{href:_,type:"wc-admin"},g),value:g},{display:c.toFixed(2)+"%",value:c},{display:t(d),value:r(d)},{display:t(s),value:r(s)},{display:t(m),value:r(m)},{display:Object(b.formatValue)(o(),"number",i),value:i}]})}getSummary(e){const{tax_codes:t=0,total_tax:r=0,order_tax:a=0,shipping_tax:o=0,orders_count:n=0}=e,{formatAmount:i,getCurrencyConfig:c}=this.context,l=c();return[{label:Object(s._n)("tax code","tax codes",t,"woocommerce-admin"),value:Object(b.formatValue)(l,"number",t)},{label:Object(s.__)("total tax","woocommerce-admin"),value:i(r)},{label:Object(s.__)("order tax","woocommerce-admin"),value:i(a)},{label:Object(s.__)("shipping tax","woocommerce-admin"),value:i(o)},{label:Object(s._n)("order","orders",n,"woocommerce-admin"),value:Object(b.formatValue)(l,"number",n)}]}render(){const{advancedFilters:e,filters:t,isRequesting:r,query:o}=this.props;return Object(a.createElement)(g.a,{compareBy:"taxes",endpoint:"taxes",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,getSummary:this.getSummary,summaryFields:["tax_codes","total_tax","order_tax","shipping_tax","orders_count"],isRequesting:r,itemIdField:"tax_rate_id",query:o,searchBy:"taxes",tableQuery:{orderby:o.orderby||"tax_rate_id"},title:Object(s.__)("Taxes","woocommerce-admin"),columnPrefsKey:"taxes_report_columns",filters:t,advancedFilters:e})}}_.contextType=h.a;var f=_,O=r(544);class j extends a.Component{getChartMeta(){const{query:e}=this.props,t="compare-taxes"===e.filter?"item-comparison":"time-comparison";return{itemsLabel:Object(s.__)("%d taxes","woocommerce-admin"),mode:t}}render(){const{isRequesting:e,query:t,path:r}=this.props,{mode:o,itemsLabel:n}=this.getChartMeta(),s={...t};return"item-comparison"===o&&(s.segmentby="tax_rate_id"),Object(a.createElement)(a.Fragment,null,Object(a.createElement)(O.a,{query:t,path:r,filters:i.c,advancedFilters:i.a,report:"taxes"}),Object(a.createElement)(d.a,{charts:i.b,endpoint:"taxes",isRequesting:e,query:s,selectedChart:Object(c.a)(t.chart,i.b),filters:i.c,advancedFilters:i.a}),Object(a.createElement)(l.a,{charts:i.b,filters:i.c,advancedFilters:i.a,mode:o,endpoint:"taxes",query:s,path:r,isRequesting:e,itemsLabel:n,selectedChart:Object(c.a)(t.chart,i.b)}),Object(a.createElement)(f,{isRequesting:e,query:t,filters:i.c,advancedFilters:i.a}))}}j.propTypes={query:n.a.object.isRequired};t.default=j},538:function(e,t,r){"use strict";r.d(t,"e",(function(){return m})),r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return y})),r.d(t,"f",(function(){return g})),r.d(t,"h",(function(){return h})),r.d(t,"g",(function(){return _}));var a=r(16),o=r(21),n=r.n(o),s=r(5),i=r(13),c=r(12),l=r(539),d=r(23);function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.identity;return function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;const s="function"==typeof e?e(o):e,c=Object(i.getIdsFromQuery)(r);if(c.length<1)return Promise.resolve([]);const l={include:c.join(","),per_page:c.length};return n()({path:Object(a.addQueryArgs)(s,l)}).then(e=>e.map(t))}}m(c.NAMESPACE+"/products/attributes",e=>({key:e.id,label:e.name}));const u=m(c.NAMESPACE+"/products/categories",e=>({key:e.id,label:e.name})),p=m(c.NAMESPACE+"/coupons",e=>({key:e.id,label:e.code})),b=m(c.NAMESPACE+"/customers",e=>({key:e.id,label:e.name})),y=m(c.NAMESPACE+"/products",e=>({key:e.id,label:e.name})),g=m(c.NAMESPACE+"/taxes",e=>({key:e.id,label:Object(l.a)(e)}));function h(e){let{attributes:t,name:r}=e;const a=Object(d.d)("variationTitleAttributesSeparator"," - ");if(r&&r.indexOf(a)>-1)return r;const o=(t||[]).map(e=>{let{option:t}=e;return t}).join(", ");return o?r+a+o:r}const _=m(e=>{let{products:t}=e;return t?c.NAMESPACE+`/products/${t}/variations`:c.NAMESPACE+"/variations"},e=>({key:e.id,label:h(e)}))},539:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r(2);function o(e){return[e.country,e.state,e.name||Object(a.__)("TAX","woocommerce-admin"),e.priority].map(e=>e.toString().toUpperCase().trim()).filter(Boolean).join("-")}},540:function(e,t,r){"use strict";var a=r(0),o=r(2),n=r(14),s=r(68),i=r(8),c=r(5),l=r(1),d=r.n(l),m=r(22),u=r(12),p=r(20),b=r(536),y=r(537),g=r(13);function h(e){return t=>Object(s.format)(e,t)}class _ extends a.Component{shouldComponentUpdate(e){return e.isRequesting!==this.props.isRequesting||e.primaryData.isRequesting!==this.props.primaryData.isRequesting||e.secondaryData.isRequesting!==this.props.secondaryData.isRequesting||!Object(c.isEqual)(e.query,this.props.query)}getItemChartData(){const{primaryData:e,selectedChart:t}=this.props;return e.data.intervals.map((function(e){const r={};return e.subtotals.segments.forEach((function(e){if(e.segment_label){const a=r[e.segment_label]?e.segment_label+" (#"+e.segment_id+")":e.segment_label;r[e.segment_id]={label:a,value:e.subtotals[t.key]||0}}})),{date:Object(s.format)("Y-m-d\\TH:i:s",e.date_start),...r}}))}getTimeChartData(){const{query:e,primaryData:t,secondaryData:r,selectedChart:a,defaultDateRange:o}=this.props,n=Object(p.getIntervalForQuery)(e,o),{primary:i,secondary:c}=Object(p.getCurrentDates)(e,o);return t.data.intervals.map((function(t,o){const l=Object(p.getPreviousDate)(t.date_start,i.after,c.after,e.compare,n),d=r.data.intervals[o];return{date:Object(s.format)("Y-m-d\\TH:i:s",t.date_start),primary:{label:`${i.label} (${i.range})`,labelDate:t.date_start,value:t.subtotals[a.key]||0},secondary:{label:`${c.label} (${c.range})`,labelDate:l.format("YYYY-MM-DD HH:mm:ss"),value:d&&d.subtotals[a.key]||0}}}))}getTimeChartTotals(){const{primaryData:e,secondaryData:t,selectedChart:r}=this.props;return{primary:Object(c.get)(e,["data","totals",r.key],null),secondary:Object(c.get)(t,["data","totals",r.key],null)}}renderChart(e,t,r,n){const{emptySearchResults:s,filterParam:i,interactiveLegend:c,itemsLabel:l,legendPosition:d,path:b,query:y,selectedChart:g,showHeaderControls:_,primaryData:f,defaultDateRange:O}=this.props,j=Object(p.getIntervalForQuery)(y,O),x=Object(p.getAllowedIntervalsForQuery)(y,O),v=Object(p.getDateFormatsForInterval)(j,f.data.intervals.length,{type:"php"}),C=s?Object(o.__)("No data for the current search","woocommerce-admin"):Object(o.__)("No data for the selected date range","woocommerce-admin"),{formatAmount:w,getCurrencyConfig:R}=this.context;return Object(a.createElement)(m.Chart,{allowedIntervals:x,data:r,dateParser:"%Y-%m-%dT%H:%M:%S",emptyMessage:C,filterParam:i,interactiveLegend:c,interval:j,isRequesting:t,itemsLabel:l,legendPosition:d,legendTotals:n,mode:e,path:b,query:y,screenReaderFormat:h(v.screenReaderFormat),showHeaderControls:_,title:g.label,tooltipLabelFormat:h(v.tooltipLabelFormat),tooltipTitle:"time-comparison"===e&&g.label||null,tooltipValueFormat:Object(u.getTooltipValueFormat)(g.type,w),chartType:Object(p.getChartTypeForQuery)(y),valueType:g.type,xFormat:h(v.xFormat),x2Format:h(v.x2Format),currency:R()})}renderItemComparison(){const{isRequesting:e,primaryData:t}=this.props;if(t.isError)return Object(a.createElement)(y.a,null);const r=e||t.isRequesting,o=this.getItemChartData();return this.renderChart("item-comparison",r,o)}renderTimeComparison(){const{isRequesting:e,primaryData:t,secondaryData:r}=this.props;if(!t||t.isError||r.isError)return Object(a.createElement)(y.a,null);const o=e||t.isRequesting||r.isRequesting,n=this.getTimeChartData(),s=this.getTimeChartTotals();return this.renderChart("time-comparison",o,n,s)}render(){const{mode:e}=this.props;return"item-comparison"===e?this.renderItemComparison():this.renderTimeComparison()}}_.contextType=b.a,_.propTypes={filters:d.a.array,isRequesting:d.a.bool,itemsLabel:d.a.string,limitProperties:d.a.array,mode:d.a.string,path:d.a.string.isRequired,primaryData:d.a.object,query:d.a.object.isRequired,secondaryData:d.a.object,selectedChart:d.a.shape({key:d.a.string.isRequired,label:d.a.string.isRequired,order:d.a.oneOf(["asc","desc"]),orderby:d.a.string,type:d.a.oneOf(["average","number","currency"]).isRequired}).isRequired},_.defaultProps={isRequesting:!1,primaryData:{data:{intervals:[]},isError:!1,isRequesting:!1},secondaryData:{data:{intervals:[]},isError:!1,isRequesting:!1}};t.a=Object(n.compose)(Object(i.withSelect)((e,t)=>{const{charts:r,endpoint:a,filters:o,isRequesting:n,limitProperties:s,query:i,advancedFilters:l}=t,d=s||[a],m=function e(t,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t||0===t.length)return null;const o=t.slice(0),n=o.pop();if(n.showFilters(r,a)){const e=Object(g.flattenFilters)(n.filters),t=r[n.param]||n.defaultValue||"all";return Object(c.find)(e,{value:t})}return e(o,r,a)}(o,i),p=Object(c.get)(m,["settings","param"]),b=t.mode||function(e,t){if(e&&t){const r=Object(c.get)(e,["settings","param"]);if(!r||Object.keys(t).includes(r))return Object(c.get)(e,["chartMode"])}return null}(m,i)||"time-comparison",{woocommerce_default_date_range:y}=e(u.SETTINGS_STORE_NAME).getSetting("wc_admin","wcAdminSettings"),h=e(u.REPORTS_STORE_NAME),_={mode:b,filterParam:p,defaultDateRange:y};if(n)return _;const f=d.some(e=>i[e]&&i[e].length);if(i.search&&!f)return{..._,emptySearchResults:!0};const O=r&&r.map(e=>e.key),j=Object(u.getReportChartData)({endpoint:a,dataType:"primary",query:i,selector:h,limitBy:d,filters:o,advancedFilters:l,defaultDateRange:y,fields:O});if("item-comparison"===b)return{..._,primaryData:j};const x=Object(u.getReportChartData)({endpoint:a,dataType:"secondary",query:i,selector:h,limitBy:d,filters:o,advancedFilters:l,defaultDateRange:y,fields:O});return{..._,primaryData:j,secondaryData:x}}))(_)},542:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r(5);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=Object(a.find)(t,{key:e});return r||t[0]}},543:function(e,t,r){"use strict";var a=r(0),o=r(2),n=r(14),s=r(8),i=r(1),c=r.n(i),l=r(13),d=r(22),m=r(136),u=r(12),p=r(20),b=r(17),y=r(537),g=r(536);class h extends a.Component{formatVal(e,t){const{formatAmount:r,getCurrencyConfig:a}=this.context;return"currency"===t?r(e):Object(m.formatValue)(a(),t,e)}getValues(e,t){const{emptySearchResults:r,summaryData:a}=this.props,{totals:o}=a,n=o.primary?o.primary[e]:0,s=o.secondary?o.secondary[e]:0,i=r?0:n,c=r?0:s;return{delta:Object(m.calculateDelta)(i,c),prevValue:this.formatVal(c,t),value:this.formatVal(i,t)}}render(){const{charts:e,query:t,selectedChart:r,summaryData:n,endpoint:s,report:i,defaultDateRange:c}=this.props,{isError:m,isRequesting:u}=n;if(m)return Object(a.createElement)(y.a,null);if(u)return Object(a.createElement)(d.SummaryListPlaceholder,{numberOfItems:e.length});const{compare:g}=Object(p.getDateParamsFromQuery)(t,c);return Object(a.createElement)(d.SummaryList,null,t=>{let{onToggle:n}=t;return e.map(e=>{const{key:t,order:c,orderby:m,label:u,type:p,isReverseTrend:y,labelTooltipText:h}=e,_={chart:t};m&&(_.orderby=m),c&&(_.order=c);const f=Object(l.getNewPath)(_),O=r.key===t,{delta:j,prevValue:x,value:v}=this.getValues(t,p);return Object(a.createElement)(d.SummaryNumber,{key:t,delta:j,href:f,label:u,reverseTrend:y,prevLabel:"previous_period"===g?Object(o.__)("Previous period:","woocommerce-admin"):Object(o.__)("Previous year:","woocommerce-admin"),prevValue:x,selected:O,value:v,labelTooltipText:h,onLinkClickCallback:()=>{n&&n(),Object(b.recordEvent)("analytics_chart_tab_click",{report:i||s,key:t})}})})})}}h.propTypes={charts:c.a.array.isRequired,endpoint:c.a.string.isRequired,limitProperties:c.a.array,query:c.a.object.isRequired,selectedChart:c.a.shape({key:c.a.string.isRequired,label:c.a.string.isRequired,order:c.a.oneOf(["asc","desc"]),orderby:c.a.string,type:c.a.oneOf(["average","number","currency"]).isRequired}).isRequired,summaryData:c.a.object,report:c.a.string},h.defaultProps={summaryData:{totals:{primary:{},secondary:{}},isError:!1}},h.contextType=g.a,t.a=Object(n.compose)(Object(s.withSelect)((e,t)=>{const{charts:r,endpoint:a,limitProperties:o,query:n,filters:s,advancedFilters:i}=t,c=o||[a],l=c.some(e=>n[e]&&n[e].length);if(n.search&&!l)return{emptySearchResults:!0};const d=r&&r.map(e=>e.key),{woocommerce_default_date_range:m}=e(u.SETTINGS_STORE_NAME).getSetting("wc_admin","wcAdminSettings");return{summaryData:Object(u.getSummaryNumbers)({endpoint:a,query:n,select:e,limitBy:c,filters:s,advancedFilters:i,defaultDateRange:m,fields:d}),defaultDateRange:m}}))(h)},567:function(e,t,r){"use strict";r.d(t,"b",(function(){return m})),r.d(t,"a",(function(){return u})),r.d(t,"c",(function(){return b}));var a=r(2),o=r(27),n=r(12),s=r(8),i=r(538),c=r(539),l=r(69);const{addCesSurveyForAnalytics:d}=Object(s.dispatch)(l.c),m=Object(o.applyFilters)("woocommerce_admin_taxes_report_charts",[{key:"total_tax",label:Object(a.__)("Total tax","woocommerce-admin"),order:"desc",orderby:"total_tax",type:"currency"},{key:"order_tax",label:Object(a.__)("Order tax","woocommerce-admin"),order:"desc",orderby:"order_tax",type:"currency"},{key:"shipping_tax",label:Object(a.__)("Shipping tax","woocommerce-admin"),order:"desc",orderby:"shipping_tax",type:"currency"},{key:"orders_count",label:Object(a.__)("Orders","woocommerce-admin"),order:"desc",orderby:"orders_count",type:"number"}]),u=Object(o.applyFilters)("woocommerce_admin_taxes_report_advanced_filters",{filters:{},title:Object(a._x)("Taxes match {{select /}} filters","A sentence describing filters for Taxes. See screen shot for context: https://cloudup.com/cSsUY9VeCVJ","woocommerce-admin")}),p=[{label:Object(a.__)("All taxes","woocommerce-admin"),value:"all"},{label:Object(a.__)("Comparison","woocommerce-admin"),value:"compare-taxes",chartMode:"item-comparison",settings:{type:"taxes",param:"taxes",getLabels:Object(i.e)(n.NAMESPACE+"/taxes",e=>({id:e.id,key:e.id,label:Object(c.a)(e)})),labels:{helpText:Object(a.__)("Check at least two tax codes below to compare","woocommerce-admin"),placeholder:Object(a.__)("Search for tax codes to compare","woocommerce-admin"),title:Object(a.__)("Compare Tax Codes","woocommerce-admin"),update:Object(a.__)("Compare","woocommerce-admin")},onClick:d}}];Object.keys(u.filters).length&&p.push({label:Object(a.__)("Advanced filters","woocommerce-admin"),value:"advanced"});const b=Object(o.applyFilters)("woocommerce_admin_taxes_report_filters",[{label:Object(a.__)("Show","woocommerce-admin"),staticParams:["chartType","paged","per_page"],param:"filter",showFilters:()=>!0,filters:p}])}}]);