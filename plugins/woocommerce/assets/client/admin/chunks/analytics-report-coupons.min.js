(window.__wcAdmin_webpackJsonp=window.__wcAdmin_webpackJsonp||[]).push([[9],{517:function(e,t,r){"use strict";r.r(t);var a=r(0),o=r(1),n=r.n(o),s=r(2),c=r(566),i=r(5),l=r(22),u=r(13),m=r(136),d=r(20),p=r(545),b=r(536),y=r(23);class g extends a.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:Object(s.__)("Coupon code","woocommerce-admin"),key:"code",required:!0,isLeftAligned:!0,isSortable:!0},{label:Object(s.__)("Orders","woocommerce-admin"),key:"orders_count",required:!0,defaultSort:!0,isSortable:!0,isNumeric:!0},{label:Object(s.__)("Amount discounted","woocommerce-admin"),key:"amount",isSortable:!0,isNumeric:!0},{label:Object(s.__)("Created","woocommerce-admin"),key:"created"},{label:Object(s.__)("Expires","woocommerce-admin"),key:"expires"},{label:Object(s.__)("Type","woocommerce-admin"),key:"type"}]}getRowsContent(e){const{query:t}=this.props,r=Object(u.getPersistedQuery)(t),o=Object(y.d)("dateFormat",d.defaultTableDateFormat),{formatAmount:n,formatDecimal:c,getCurrencyConfig:p}=this.context;return Object(i.map)(e,e=>{const{amount:t,coupon_id:i,orders_count:d}=e,b=e.extended_info||{},{code:y,date_created:g,date_expires:h,discount_type:f}=b,_=i>0?Object(u.getNewPath)(r,"/analytics/coupons",{filter:"single_coupon",coupons:i}):null,O=null===_?y:Object(a.createElement)(l.Link,{href:_,type:"wc-admin"},y),j=i>0?Object(u.getNewPath)(r,"/analytics/orders",{filter:"advanced",coupon_includes:i}):null;return[{display:O,value:y},{display:null===j?d:Object(a.createElement)(l.Link,{href:j,type:"wc-admin"},Object(m.formatValue)(p(),"number",d)),value:d},{display:n(t),value:c(t)},{display:g?Object(a.createElement)(l.Date,{date:g,visibleFormat:o}):Object(s.__)("N/A","woocommerce-admin"),value:g},{display:h?Object(a.createElement)(l.Date,{date:h,visibleFormat:o}):Object(s.__)("N/A","woocommerce-admin"),value:h},{display:this.getCouponType(f),value:f}]})}getSummary(e){const{coupons_count:t=0,orders_count:r=0,amount:a=0}=e,{formatAmount:o,getCurrencyConfig:n}=this.context,c=n();return[{label:Object(s._n)("Coupon","Coupons",t,"woocommerce-admin"),value:Object(m.formatValue)(c,"number",t)},{label:Object(s._n)("Order","Orders",r,"woocommerce-admin"),value:Object(m.formatValue)(c,"number",r)},{label:Object(s.__)("Amount discounted","woocommerce-admin"),value:o(a)}]}getCouponType(e){return{percent:Object(s.__)("Percentage","woocommerce-admin"),fixed_cart:Object(s.__)("Fixed cart","woocommerce-admin"),fixed_product:Object(s.__)("Fixed product","woocommerce-admin")}[e]||Object(s.__)("N/A","woocommerce-admin")}render(){const{advancedFilters:e,filters:t,isRequesting:r,query:o}=this.props;return Object(a.createElement)(p.a,{compareBy:"coupons",endpoint:"coupons",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,getSummary:this.getSummary,summaryFields:["coupons_count","orders_count","amount"],isRequesting:r,itemIdField:"coupon_id",query:o,searchBy:"coupons",tableQuery:{orderby:o.orderby||"orders_count",order:o.order||"desc",extended_info:!0},title:Object(s.__)("Coupons","woocommerce-admin"),columnPrefsKey:"coupons_report_columns",filters:t,advancedFilters:e})}}g.contextType=b.a;var h=g,f=r(542),_=r(540),O=r(543),j=r(544);class v extends a.Component{getChartMeta(){const{query:e}=this.props,t="compare-coupons"===e.filter&&e.coupons&&e.coupons.split(",").length>1?"item-comparison":"time-comparison";return{itemsLabel:Object(s.__)("%d coupons","woocommerce-admin"),mode:t}}render(){const{isRequesting:e,query:t,path:r}=this.props,{mode:o,itemsLabel:n}=this.getChartMeta(),s={...t};return"item-comparison"===o&&(s.segmentby="coupon"),Object(a.createElement)(a.Fragment,null,Object(a.createElement)(j.a,{query:t,path:r,filters:c.c,advancedFilters:c.a,report:"coupons"}),Object(a.createElement)(O.a,{charts:c.b,endpoint:"coupons",isRequesting:e,query:s,selectedChart:Object(f.a)(t.chart,c.b),filters:c.c,advancedFilters:c.a}),Object(a.createElement)(_.a,{charts:c.b,filters:c.c,advancedFilters:c.a,mode:o,endpoint:"coupons",path:r,query:s,isRequesting:e,itemsLabel:n,selectedChart:Object(f.a)(t.chart,c.b)}),Object(a.createElement)(h,{isRequesting:e,query:t,filters:c.c,advancedFilters:c.a}))}}v.propTypes={query:n.a.object.isRequired};t.default=v},538:function(e,t,r){"use strict";r.d(t,"e",(function(){return m})),r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return y})),r.d(t,"f",(function(){return g})),r.d(t,"h",(function(){return h})),r.d(t,"g",(function(){return f}));var a=r(16),o=r(21),n=r.n(o),s=r(5),c=r(13),i=r(12),l=r(539),u=r(23);function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.identity;return function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;const s="function"==typeof e?e(o):e,i=Object(c.getIdsFromQuery)(r);if(i.length<1)return Promise.resolve([]);const l={include:i.join(","),per_page:i.length};return n()({path:Object(a.addQueryArgs)(s,l)}).then(e=>e.map(t))}}m(i.NAMESPACE+"/products/attributes",e=>({key:e.id,label:e.name}));const d=m(i.NAMESPACE+"/products/categories",e=>({key:e.id,label:e.name})),p=m(i.NAMESPACE+"/coupons",e=>({key:e.id,label:e.code})),b=m(i.NAMESPACE+"/customers",e=>({key:e.id,label:e.name})),y=m(i.NAMESPACE+"/products",e=>({key:e.id,label:e.name})),g=m(i.NAMESPACE+"/taxes",e=>({key:e.id,label:Object(l.a)(e)}));function h(e){let{attributes:t,name:r}=e;const a=Object(u.d)("variationTitleAttributesSeparator"," - ");if(r&&r.indexOf(a)>-1)return r;const o=(t||[]).map(e=>{let{option:t}=e;return t}).join(", ");return o?r+a+o:r}const f=m(e=>{let{products:t}=e;return t?i.NAMESPACE+`/products/${t}/variations`:i.NAMESPACE+"/variations"},e=>({key:e.id,label:h(e)}))},539:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r(2);function o(e){return[e.country,e.state,e.name||Object(a.__)("TAX","woocommerce-admin"),e.priority].map(e=>e.toString().toUpperCase().trim()).filter(Boolean).join("-")}},540:function(e,t,r){"use strict";var a=r(0),o=r(2),n=r(14),s=r(68),c=r(8),i=r(5),l=r(1),u=r.n(l),m=r(22),d=r(12),p=r(20),b=r(536),y=r(537),g=r(13);function h(e){return t=>Object(s.format)(e,t)}class f extends a.Component{shouldComponentUpdate(e){return e.isRequesting!==this.props.isRequesting||e.primaryData.isRequesting!==this.props.primaryData.isRequesting||e.secondaryData.isRequesting!==this.props.secondaryData.isRequesting||!Object(i.isEqual)(e.query,this.props.query)}getItemChartData(){const{primaryData:e,selectedChart:t}=this.props;return e.data.intervals.map((function(e){const r={};return e.subtotals.segments.forEach((function(e){if(e.segment_label){const a=r[e.segment_label]?e.segment_label+" (#"+e.segment_id+")":e.segment_label;r[e.segment_id]={label:a,value:e.subtotals[t.key]||0}}})),{date:Object(s.format)("Y-m-d\\TH:i:s",e.date_start),...r}}))}getTimeChartData(){const{query:e,primaryData:t,secondaryData:r,selectedChart:a,defaultDateRange:o}=this.props,n=Object(p.getIntervalForQuery)(e,o),{primary:c,secondary:i}=Object(p.getCurrentDates)(e,o);return t.data.intervals.map((function(t,o){const l=Object(p.getPreviousDate)(t.date_start,c.after,i.after,e.compare,n),u=r.data.intervals[o];return{date:Object(s.format)("Y-m-d\\TH:i:s",t.date_start),primary:{label:`${c.label} (${c.range})`,labelDate:t.date_start,value:t.subtotals[a.key]||0},secondary:{label:`${i.label} (${i.range})`,labelDate:l.format("YYYY-MM-DD HH:mm:ss"),value:u&&u.subtotals[a.key]||0}}}))}getTimeChartTotals(){const{primaryData:e,secondaryData:t,selectedChart:r}=this.props;return{primary:Object(i.get)(e,["data","totals",r.key],null),secondary:Object(i.get)(t,["data","totals",r.key],null)}}renderChart(e,t,r,n){const{emptySearchResults:s,filterParam:c,interactiveLegend:i,itemsLabel:l,legendPosition:u,path:b,query:y,selectedChart:g,showHeaderControls:f,primaryData:_,defaultDateRange:O}=this.props,j=Object(p.getIntervalForQuery)(y,O),v=Object(p.getAllowedIntervalsForQuery)(y,O),C=Object(p.getDateFormatsForInterval)(j,_.data.intervals.length,{type:"php"}),w=s?Object(o.__)("No data for the current search","woocommerce-admin"):Object(o.__)("No data for the selected date range","woocommerce-admin"),{formatAmount:R,getCurrencyConfig:q}=this.context;return Object(a.createElement)(m.Chart,{allowedIntervals:v,data:r,dateParser:"%Y-%m-%dT%H:%M:%S",emptyMessage:w,filterParam:c,interactiveLegend:i,interval:j,isRequesting:t,itemsLabel:l,legendPosition:u,legendTotals:n,mode:e,path:b,query:y,screenReaderFormat:h(C.screenReaderFormat),showHeaderControls:f,title:g.label,tooltipLabelFormat:h(C.tooltipLabelFormat),tooltipTitle:"time-comparison"===e&&g.label||null,tooltipValueFormat:Object(d.getTooltipValueFormat)(g.type,R),chartType:Object(p.getChartTypeForQuery)(y),valueType:g.type,xFormat:h(C.xFormat),x2Format:h(C.x2Format),currency:q()})}renderItemComparison(){const{isRequesting:e,primaryData:t}=this.props;if(t.isError)return Object(a.createElement)(y.a,null);const r=e||t.isRequesting,o=this.getItemChartData();return this.renderChart("item-comparison",r,o)}renderTimeComparison(){const{isRequesting:e,primaryData:t,secondaryData:r}=this.props;if(!t||t.isError||r.isError)return Object(a.createElement)(y.a,null);const o=e||t.isRequesting||r.isRequesting,n=this.getTimeChartData(),s=this.getTimeChartTotals();return this.renderChart("time-comparison",o,n,s)}render(){const{mode:e}=this.props;return"item-comparison"===e?this.renderItemComparison():this.renderTimeComparison()}}f.contextType=b.a,f.propTypes={filters:u.a.array,isRequesting:u.a.bool,itemsLabel:u.a.string,limitProperties:u.a.array,mode:u.a.string,path:u.a.string.isRequired,primaryData:u.a.object,query:u.a.object.isRequired,secondaryData:u.a.object,selectedChart:u.a.shape({key:u.a.string.isRequired,label:u.a.string.isRequired,order:u.a.oneOf(["asc","desc"]),orderby:u.a.string,type:u.a.oneOf(["average","number","currency"]).isRequired}).isRequired},f.defaultProps={isRequesting:!1,primaryData:{data:{intervals:[]},isError:!1,isRequesting:!1},secondaryData:{data:{intervals:[]},isError:!1,isRequesting:!1}};t.a=Object(n.compose)(Object(c.withSelect)((e,t)=>{const{charts:r,endpoint:a,filters:o,isRequesting:n,limitProperties:s,query:c,advancedFilters:l}=t,u=s||[a],m=function e(t,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t||0===t.length)return null;const o=t.slice(0),n=o.pop();if(n.showFilters(r,a)){const e=Object(g.flattenFilters)(n.filters),t=r[n.param]||n.defaultValue||"all";return Object(i.find)(e,{value:t})}return e(o,r,a)}(o,c),p=Object(i.get)(m,["settings","param"]),b=t.mode||function(e,t){if(e&&t){const r=Object(i.get)(e,["settings","param"]);if(!r||Object.keys(t).includes(r))return Object(i.get)(e,["chartMode"])}return null}(m,c)||"time-comparison",{woocommerce_default_date_range:y}=e(d.SETTINGS_STORE_NAME).getSetting("wc_admin","wcAdminSettings"),h=e(d.REPORTS_STORE_NAME),f={mode:b,filterParam:p,defaultDateRange:y};if(n)return f;const _=u.some(e=>c[e]&&c[e].length);if(c.search&&!_)return{...f,emptySearchResults:!0};const O=r&&r.map(e=>e.key),j=Object(d.getReportChartData)({endpoint:a,dataType:"primary",query:c,selector:h,limitBy:u,filters:o,advancedFilters:l,defaultDateRange:y,fields:O});if("item-comparison"===b)return{...f,primaryData:j};const v=Object(d.getReportChartData)({endpoint:a,dataType:"secondary",query:c,selector:h,limitBy:u,filters:o,advancedFilters:l,defaultDateRange:y,fields:O});return{...f,primaryData:j,secondaryData:v}}))(f)},542:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r(5);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=Object(a.find)(t,{key:e});return r||t[0]}},543:function(e,t,r){"use strict";var a=r(0),o=r(2),n=r(14),s=r(8),c=r(1),i=r.n(c),l=r(13),u=r(22),m=r(136),d=r(12),p=r(20),b=r(17),y=r(537),g=r(536);class h extends a.Component{formatVal(e,t){const{formatAmount:r,getCurrencyConfig:a}=this.context;return"currency"===t?r(e):Object(m.formatValue)(a(),t,e)}getValues(e,t){const{emptySearchResults:r,summaryData:a}=this.props,{totals:o}=a,n=o.primary?o.primary[e]:0,s=o.secondary?o.secondary[e]:0,c=r?0:n,i=r?0:s;return{delta:Object(m.calculateDelta)(c,i),prevValue:this.formatVal(i,t),value:this.formatVal(c,t)}}render(){const{charts:e,query:t,selectedChart:r,summaryData:n,endpoint:s,report:c,defaultDateRange:i}=this.props,{isError:m,isRequesting:d}=n;if(m)return Object(a.createElement)(y.a,null);if(d)return Object(a.createElement)(u.SummaryListPlaceholder,{numberOfItems:e.length});const{compare:g}=Object(p.getDateParamsFromQuery)(t,i);return Object(a.createElement)(u.SummaryList,null,t=>{let{onToggle:n}=t;return e.map(e=>{const{key:t,order:i,orderby:m,label:d,type:p,isReverseTrend:y,labelTooltipText:h}=e,f={chart:t};m&&(f.orderby=m),i&&(f.order=i);const _=Object(l.getNewPath)(f),O=r.key===t,{delta:j,prevValue:v,value:C}=this.getValues(t,p);return Object(a.createElement)(u.SummaryNumber,{key:t,delta:j,href:_,label:d,reverseTrend:y,prevLabel:"previous_period"===g?Object(o.__)("Previous period:","woocommerce-admin"):Object(o.__)("Previous year:","woocommerce-admin"),prevValue:v,selected:O,value:C,labelTooltipText:h,onLinkClickCallback:()=>{n&&n(),Object(b.recordEvent)("analytics_chart_tab_click",{report:c||s,key:t})}})})})}}h.propTypes={charts:i.a.array.isRequired,endpoint:i.a.string.isRequired,limitProperties:i.a.array,query:i.a.object.isRequired,selectedChart:i.a.shape({key:i.a.string.isRequired,label:i.a.string.isRequired,order:i.a.oneOf(["asc","desc"]),orderby:i.a.string,type:i.a.oneOf(["average","number","currency"]).isRequired}).isRequired,summaryData:i.a.object,report:i.a.string},h.defaultProps={summaryData:{totals:{primary:{},secondary:{}},isError:!1}},h.contextType=g.a,t.a=Object(n.compose)(Object(s.withSelect)((e,t)=>{const{charts:r,endpoint:a,limitProperties:o,query:n,filters:s,advancedFilters:c}=t,i=o||[a],l=i.some(e=>n[e]&&n[e].length);if(n.search&&!l)return{emptySearchResults:!0};const u=r&&r.map(e=>e.key),{woocommerce_default_date_range:m}=e(d.SETTINGS_STORE_NAME).getSetting("wc_admin","wcAdminSettings");return{summaryData:Object(d.getSummaryNumbers)({endpoint:a,query:n,select:e,limitBy:i,filters:s,advancedFilters:c,defaultDateRange:m,fields:u}),defaultDateRange:m}}))(h)},566:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return u})),r.d(t,"c",(function(){return d}));var a=r(2),o=r(27),n=r(8),s=r(538),c=r(69);const{addCesSurveyForAnalytics:i}=Object(n.dispatch)(c.c),l=Object(o.applyFilters)("woocommerce_admin_coupons_report_charts",[{key:"orders_count",label:Object(a.__)("Discounted orders","woocommerce-admin"),order:"desc",orderby:"orders_count",type:"number"},{key:"amount",label:Object(a.__)("Amount","woocommerce-admin"),order:"desc",orderby:"amount",type:"currency"}]),u=Object(o.applyFilters)("woocommerce_admin_coupon_report_advanced_filters",{filters:{},title:Object(a._x)("Coupons match {{select /}} filters","A sentence describing filters for Coupons. See screen shot for context: https://cloudup.com/cSsUY9VeCVJ","woocommerce-admin")}),m=[{label:Object(a.__)("All coupons","woocommerce-admin"),value:"all"},{label:Object(a.__)("Single coupon","woocommerce-admin"),value:"select_coupon",chartMode:"item-comparison",subFilters:[{component:"Search",value:"single_coupon",chartMode:"item-comparison",path:["select_coupon"],settings:{type:"coupons",param:"coupons",getLabels:s.b,labels:{placeholder:Object(a.__)("Type to search for a coupon","woocommerce-admin"),button:Object(a.__)("Single Coupon","woocommerce-admin")}}}]},{label:Object(a.__)("Comparison","woocommerce-admin"),value:"compare-coupons",settings:{type:"coupons",param:"coupons",getLabels:s.b,labels:{title:Object(a.__)("Compare Coupon Codes","woocommerce-admin"),update:Object(a.__)("Compare","woocommerce-admin"),helpText:Object(a.__)("Check at least two coupon codes below to compare","woocommerce-admin")},onClick:i}}];Object.keys(u.filters).length&&m.push({label:Object(a.__)("Advanced filters","woocommerce-admin"),value:"advanced"});const d=Object(o.applyFilters)("woocommerce_admin_coupons_report_filters",[{label:Object(a.__)("Show","woocommerce-admin"),staticParams:["chartType","paged","per_page"],param:"filter",showFilters:()=>!0,filters:m}])}}]);